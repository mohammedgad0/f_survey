{% extends "base.html" %}
{% load i18n %}
{% block title %}Family Survey Form{% endblock %}
{% block stylesheets %}
  {{ block.super }}
  <style>

  label.error { float: none; color: red; margin: 0 .5em 0 0; vertical-align: top; font-size: 10px; display:block }
  </style>
{% endblock stylesheets %}

{% block content %}
        <button type='submit' onclick="location.href='#'"  class="button"><span><i class="fa fas fa-users"></i> {{ _('View all members') }}</span></button>

      <div class="container-form">
      <!-- User query form added by Wisal, 7/17/08 -->
        <!--<div class="row">
          <div class="col-lg-12 text-center">
            <h2>{% trans 'Add Family Member' %}</h2>
          </div>
        </div>-->
        <form action="" method="post" id="family-survey-from">
              <fieldset class="scheduler-border">
                 <legend class="scheduler-border"><i class="fas fa fa-user-plus"></i> {{ _('Add Family Member') }}</legend>

                   {% csrf_token %}


                      <div class="col-md-6">
                        <div class="form-group">
                          {{ form_step1.member_name_first }}
                          <label for="first" class="control-label">{{ _('First Name') }}</label>
                          <i class="bar"></i>
                        </div>
                      </div>
                      <!--  col-md-12   -->
                      <div class="col-md-6">
                        <div class="form-group">

                          {{ form_step1.member_name_second }}
                          <label for="last" class="control-label">{{ _('Second Name') }}</label>
                          <i class="bar"></i>
                        </div>
                      </div>
                      <!--  col-md-12   -->

                      <div class="col-md-6">
                        <div class="form-group">

                          {{ form_step1.member_name_third }}
                          <label for="input" class="control-label">{{ _('Third Name') }}</label>
                          <i class="bar"></i>
                        </div>
                      </div>
                      <!--  col-md-12   -->
                      <div class="col-md-6">
                        <div class="form-group">

                          {{ form_step1.id_number_member }}
                          <label for="input" class="control-label">{{ _('No. (National Identity / Residence / Visitor Limit) per person') }}</label>
                          <i class="bar"></i>
                        </div>
                      </div>
                      <!--  col-md-12   -->
                      <div class="col-md-6">
                        <div class="form-group">

                          {{ form_step1.family_relation }}
                          <label for="input" class="control-label">{{ _('Relation') }}</label>
                          <i class="bar"></i>
                          </div>
                      </div>
                      <!--  col-md-12   -->
                      <div class="col-md-6">
                        <div class="form-group">

                          {{ form_step1.gender }}
                          <label for="input" class="control-label">{{ _('Gender') }}</label>
                          <i class="bar"></i>
                          </div>
                      </div>
                      <!--  col-md-12   -->
                      <div class="col-md-6">
                        <div class="form-group">
                          {{ form_step1.age }}
                          <label for="input" class="control-label">{{ _('Age') }}</label>
                          <i class="bar"></i>
                        </div>
                      </div>

                      <div class="col-md-6">
                        <div class="form-group">

                          {{ form_step1.birth_year }}
                          <label for="input" class="control-label attachment">{{ _('Birth Year') }}</label>
                          <i class="bar"></i>
                        </div>
                      </div>

                      <div class="col-md-6">
                        <div class="form-group">

                          {{ form_step1.nationality }}
                          <label for="input" class="control-label attachment">{{ _('Nationality') }}</label>
                          <i class="bar"></i>
                        </div>
                      </div>
                      <div class="col-lg-12">
                    <fieldset class="scheduler-border">
                        <legend  class="scheduler-border"><i class="fa fa-wheelchair" style="font-size:24px;"></i> {{ _('Difficulty type') }}</legend>
                      <div class="error" id="form_error"></div>
                      <div class="col-md-12">
                        <div class="checkbox require-one">
                          <label>
                          {{ form_step1.difficulty_1 }}
                          <i class="helper"></i>{{ _('Eyesight difficulty') }}
                         </label>
                       </div>
                      </div>

                      <div class="col-lg-12 levels level-1 id_difficulty_1">
                        <span>{{ form_step1.difficulty_1_degree.label }}</span>
                        <div class="form-radio">

                          {% for choice in form_step1.difficulty_1_degree %}
                          <div class="col-lg-4">
                            <div class="radio">
                              <label>
                              {{ choice.tag }}
                              <i class="helper"></i>{{ choice.choice_label }}
                              </label>
                            </div>
                          </div>
                          {% endfor %}
                        </div>
                      </div>

                      <div class="col-md-12 require-one">
                        <div class="checkbox">
                          <label>
                          {{ form_step1.difficulty_2 }}
                          <i class="helper"></i>{{ _('Hearing power difficulty') }}
                         </label>
                       </div>

                      </div>

                      <div class="col-lg-12 levels level-2 id_difficulty_2">
                        <span>{{ form_step1.difficulty_2_degree.label }}</span>

                        <div class="form-radio">

                          {% for choice in form_step1.difficulty_2_degree %}
                          <div class="col-lg-4">
                            <div class="radio">
                              <label>
                              {{ choice.tag }}
                              <i class="helper"></i>{{ choice.choice_label }}
                              </label>
                            </div>
                          </div>
                          {% endfor %}
                        </div>
                      </div>

                      <div class="col-md-12 require-one">
                        <div class="checkbox">
                          <label>
                          {{ form_step1.difficulty_3 }}
                          <i class="helper"></i>{{ _('Movement difficulty') }}
                         </label>
                       </div>

                      </div>

                      <div class="col-lg-12 levels level-3 id_difficulty_3">
                        <span>{{ form_step1.difficulty_3_degree.label }}</span>
                        <div class="form-radio">
                          {% for choice in form_step1.difficulty_3_degree %}
                            <div class="col-lg-4">
                              <div class="radio">
                                <label>
                                {{ choice.tag }}
                                <i class="helper"></i>{{ choice.choice_label }}
                                </label>
                              </div>
                            </div>
                          {% endfor %}
                        </div>
                      </div>

                      <div class="col-md-12 require-one">
                        <div class="checkbox">
                          <label>
                          {{ form_step1.difficulty_4 }}
                          <i class="helper"></i>{{ _('Memory difficulty') }}
                         </label>
                       </div>
                      </div>

                      <div class="col-lg-12 levels level-4 id_difficulty_4">
                        <span>{{ form_step1.difficulty_4_degree.label }}</span>

                        <div class="form-radio ">
                          {% for choice in form_step1.difficulty_4_degree %}
                          <div class="col-lg-4">
                            <div class="radio">
                              <label>
                              {{ choice.tag }}
                              <i class="helper"></i>{{ choice.choice_label }}
                              </label>
                            </div>
                          </div>
                          {% endfor %}
                        </div>
                      </div>

                      <div class="col-md-12 require-one">
                        <div class="checkbox">
                          <label>
                          {{ form_step1.difficulty_5 }}
                          <i class="helper"></i>{{ _('Personal care') }}
                         </label>
                       </div>

                      </div>

                      <div class="col-lg-12 levels level-5 id_difficulty_5">
                        <span>{{ form_step1.difficulty_5_degree.label }}</span>

                        <div class="form-radio ">
                          {% for choice in form_step1.difficulty_5_degree %}
                          <div class="col-lg-4">
                            <div class="radio">
                              <label>
                              {{ choice.tag }}
                              <i class="helper"></i>{{ choice.choice_label }}
                              </label>
                            </div>
                          </div>
                          {% endfor %}
                        </div>
                      </div>

                      <div class="col-md-12 require-one">
                        <div class="checkbox">
                          <label>
                          {{ form_step1.difficulty_6 }}
                          <i class="helper"></i>{{ _('Communincation') }}
                         </label>
                       </div>
                      </div>

                      <div class="col-lg-12 levels level-6 id_difficulty_6">
                        <span>{{ form_step1.difficulty_6_degree.label }}</span>

                        <div class="form-radio">
                          {% for choice in form_step1.difficulty_6_degree %}
                            <div class="col-lg-4">
                              <div class="radio">
                                <label>
                                {{ choice.tag }}
                                <i class="helper"></i>{{ choice.choice_label }}
                                </label>
                              </div>
                            </div>
                          {% endfor %}
                        </div>
                      </div>

                      <div class="col-md-12">
                        <div class="checkbox">
                          <label>
                          {{ form_step1.difficulty_other }}
                          <i class="helper"></i>{{ _('Other') }}
                         </label>
                       </div>

                      </div>

                      <div class="col-md-12 levels id_difficulty_other">
                        <div class="form-group">

                          {{ form_step1.difficulty_7_txt }}
                          <label for="input" class="control-label attachment">{{ _('Type of difficulty') }}</label>
                          <i class="bar"></i>
                        </div>
                      </div>

                      <div class="col-lg-12 levels id_difficulty_other">
                        <span>{{ form_step1.difficulty_7_degree.label }}</span>
                        <div class="form-radio">

                          {% for choice in form_step1.difficulty_7_degree %}
                          <div class="col-lg-4">
                            <div class="radio">
                              <label>
                              {{ choice.tag }}
                              <i class="helper"></i>{{ choice.choice_label }}
                              </label>
                            </div>
                          </div>
                          {% endfor %}
                        </div>
                      </div>

                      <div class="col-md-12 require-one">
                        <div class="checkbox">
                          <label>
                          {{ form_step1.difficulty_8 }}
                          <i class="helper"></i>{{ _('Not Found') }}
                         </label>
                       </div>
                      </div>
                    </fieldset>
                  </div>
                      <div  id="resi-info">

                        <div class="col-md-12">
                          <div class="form-group">

                            {{ form_step1.place_birth }}
                            <label for="input" class="control-label attachment">{{ _('Place of Birth') }}</label>
                            <i class="bar"></i>
                          </div>
                        </div>

                        <div class="col-md-6">
                          <div class="form-group">

                            {{ form_step1.place_stay_previous }}
                            <label for="input" class="control-label attachment">{{ _('Previous place of stay') }}</label>
                            <i class="bar"></i>
                          </div>
                        </div>

                      <div class="col-md-6">
                        <div class="form-group">

                          {{ form_step1.place_stay }}
                          <label for="input" class="control-label attachment">{{ _('Current place of stay') }}</label>
                          <i class="bar"></i>
                        </div>
                      </div>
                    </div>
                  </fieldset>

                    <div class="button-container-form">
                        <button type="submit" class="button"><span>{{ _('Save') }}</span></button>
                    </div>

                </form>

                <!--</fieldset>-->
              </div>


{% endblock %}

{% block javascripts %}
  {{ block.super }}
<script src="/static/build/js/plugins/moment-with-locales.min.js"></script>
<script src="/static/build/js/plugins/moment-hijri.js"></script>
<script>
//
// $.validator.addMethod('require-one', function(value) {
//       if( $('input[type="checkbox"]').is(':checked') ){
//         var parent_id = $('input[type="checkbox"]').attr('id');
//         //console.log($('.'+parent_id+ ' .form-radio .radio input').attr('name') );
//         if ( $('.'+parent_id+ ' .form-radio .radio input:checked').size() > 0){
//           return true;
//         }
//
//       }
//
// }, 'select at least one option.');
//
// var checkboxes = $('input[type="checkbox"]');
//
// var checkbox_names = $.map(checkboxes, function(e, i) {
//   return $(e).attr("name")
// }).join(" ");
//
// var radios = $('input[type="checkbox"] .form-radio .radio input');
// checkbox_names = $.map(radios, function(e, i) {
//   return $(e).attr("name")
// }).join(" ");
//
// console.log(checkbox_names);
// $("#family-survey-from").validate({
//   groups: {
//     checks: checkbox_names
//   },
//
//
//
//   errorPlacement: function(error, element) {
//     $('#form_error').html(error);
//   },
//   submitHandler: function(form) {
//       //  alert('Form Submited');
//       return true;
//   }
//
// });

// hide all required sections initially
  $('.levels').hide();
  $('#resi-info').hide();
  $('#id_difficulty_8').prop('checked', true);
  $('#id_difficulty_8').attr('required', true);


// hide or unhide residance info fields based on nationality
  $('#id_nationality').on('change', function(){
    var nationality_code = $(this).val();
    if (nationality_code == 1800001) {
      $('#resi-info').slideToggle('slow','linear');
    }
    else{
      $('#resi-info').hide();
    }
  });

// enable toggle on all checkboxes when single field is used
  $('input[type="checkbox"]').not('#id_difficulty_8').on('change', function(){

    var this_el_id = $(this).attr('id');
    $('.'+this_el_id).slideToggle('slow','linear');

    if($(this).is(':checked')){
      $('.'+this_el_id+ ' .form-radio .radio input[type="radio"]').attr('required', true);
      $('.'+this_el_id+ ' .form-group input[type="text"]').attr('required', true);
    }
    else{
      $('.'+this_el_id+ ' .form-radio .radio input[type="radio"]').attr('required', false);
      $('.'+this_el_id+ ' .form-radio .radio input[type="radio"]').attr('checked', false);
      $('.'+this_el_id+ ' .form-group input[type="text"]').attr('required', false);
      $('.'+this_el_id+ ' .form-group input[type="text"]').val("");
    }


    if ( $('#'+this_el_id).is(':checked') )
    {
      $('#id_difficulty_8').prop('checked', false);
      $('#id_difficulty_8').attr('required', false);
    }
    else
    {
      $('#id_difficulty_8').prop('checked', true);
      $('#id_difficulty_8').attr('required', true);
    }

// control not found option when one or more checkboxes are selected.
    $('input[type="checkbox"]').not('#id_difficulty_8').each(function(){

      if($(this).is(':checked')){
          $('#id_difficulty_8').prop('checked', false);
          $('#id_difficulty_8').attr('required', false);
        }
    });

// control all checkboxes, radios and textfields when not found option is selected.
    $('#id_difficulty_8').on('change', function(){

      if($(this).is(':checked')){

        $('input[type="checkbox"]').not('#id_difficulty_8').each(function(){
          var parent_el_id = $(this).attr('id');
          $(this).prop('checked', false);
          $(this).attr('required', false);
          $('.'+parent_el_id+ ' .form-radio .radio input[type="radio"]').attr('required', false);
          $('.'+this_el_id+ ' .form-radio .radio input[type="radio"]').attr('checked', false);
          $('.'+this_el_id+ ' .form-group input[type="text"]').attr('required', false);
          $('.'+this_el_id+ ' .form-group input[type="text"]').val("");
          $('.'+$(this).attr('id')).slideUp('slow');
        });
      }
      else{
        $('#id_difficulty_8').attr('required', true);
      }
    });

    //console.log(next_el);
  });

// Auto age year calculate usin moment.js plugin included in base.html
  moment.locale('en-US');
  m = moment();
  $('#id_age').on('change', function(){
    var dob_year = moment().subtract($(this).val(), 'years').calendar();
    var year = dob_year.split("/");
    var myear = year[2];
    //console.log(dob_year);
    var hyear = moment(myear, 'YYYY').endOf('iMonth').format('iYYYY');
    $('#id_birth_year').val(hyear);
  });

  $('#id_birth_year').on('change', function(){
    var year = $(this).val();
    var age = "";
    if(year > 1500)
    {
      current_year = m.format('YYYY');
       age = (current_year - year);
    }
    else if(year < 1500)
    {
      current_year = m.format('iYYYY');
      age = (current_year - year) - 1;
    }
    $('#id_age').val(age);
  });

</script>

{% endblock %}
